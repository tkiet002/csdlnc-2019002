USE MASTER
GO
IF EXISTS(SELECT NAME FROM SYSDATABASES WHERE NAME ='DB2')
	DROP DATABASE DB2
GO
CREATE DATABASE DB2
GO
USE DB2
GO
CREATE TABLE MATHANG
(
	MSMH		CHAR(10)		NOT NULL,
	TENMH		NVARCHAR(100)	NOT NULL,
	DONGIA		FLOAT			NULL,
	DVT			NVARCHAR(20)	NULL,			
	CONSTRAINT PK_MATHANG PRIMARY KEY(MSMH)
);
CREATE TABLE KHACHHANG
(
	MSKH		CHAR(10)		NOT NULL,
	TENKH		NVARCHAR(50)	NOT NULL,
	DIACHI		NVARCHAR(100)	NOT NULL,
	DIENTHOAI	VARCHAR(10)		NULL,
	CONSTRAINT PK_KHACHHANG PRIMARY KEY(MSKH)
);
CREATE TABLE NHANVIEN
(
	MSNV		CHAR(10)		NOT NULL,
	TENNV		NVARCHAR(50)	NOT NULL,
	DIACHI		NVARCHAR(100)	NOT NULL,
	CMND		CHAR(15)		NOT NULL,
	DIENTHOAI	VARCHAR(10)		NULL,
	NGAYSINH	DATETIME		NOT NULL,
	CONSTRAINT PK_NHANVIEN PRIMARY KEY(MSNV)
);
CREATE TABLE HOADON
(
	MSHD		CHAR(10)		NOT NULL,
	NGAYHD		DATETIME		NOT NULL,
	MSKH		CHAR(10)		NULL,
	MSNV		CHAR(10)		NULL,
	CONSTRAINT PK_HOADON PRIMARY KEY(MSHD)
);
CREATE TABLE CT_HOADON
(
	MSHD		CHAR(10)		NOT NULL,
	MSMH		CHAR(10)		NOT NULL,
	SOLUONG		INT				NULL,
	CONSTRAINT PK_CT_HOADON PRIMARY KEY(MSHD, MSMH)
);

---3.Create foreign keys
---------------------------HOADON --> KHACHHANG, NHANVIEN
ALTER TABLE HOADON
	ADD CONSTRAINT FK_HOADON_KHACHHANG FOREIGN KEY(MSKH) REFERENCES KHACHHANG(MSKH),
		CONSTRAINT FK_HOADON_NHANVIEN FOREIGN KEY(MSNV) REFERENCES NHANVIEN(MSNV)

---------------------------CT_HOADON --> MATHANG, HOADON
ALTER TABLE CT_HOADON
	ADD CONSTRAINT FK_CT_HOADON_MATHANG FOREIGN KEY(MSMH) REFERENCES MATHANG(MSMH),
		CONSTRAINT FK_CT_HOADON_HOADON FOREIGN KEY(MSHD) REFERENCES HOADON(MSHD)

---4.Insert data into the tables
---TẠO DỮ LIỆU MẶT HÀNG
INSERT INTO MATHANG(MSMH,TENMH,DONGIA,DVT) VALUES (1,N'HDD20',10,N'CÁI')
INSERT INTO MATHANG(MSMH,TENMH,DONGIA,DVT) VALUES (2,N'HDD40',20,N'CÁI')
INSERT INTO MATHANG(MSMH,TENMH,DONGIA,DVT) VALUES (3,N'MBPII',10,N'CÁI')
INSERT INTO MATHANG(MSMH,TENMH,DONGIA,DVT) VALUES (4,N'SDD512',15,N'CÁI')

---TẠO DỮ LIỆU KHÁCH  HÀNG	
INSERT INTO KHACHHANG(MSKH,TENKH,DIACHI,DIENTHOAI) 
VALUES (1,N'NGUYỄN VĂN A',N'16/11 BÙI THỊ XUÂN F3 TÂN BÌNH','0903648211')
INSERT INTO KHACHHANG(MSKH,TENKH,DIACHI,DIENTHOAI) 
VALUES (2,N'NGUYỄN VĂN B',N'16/11 LẠC LONG QUÂN F12 TB','0903648154')
INSERT INTO KHACHHANG(MSKH,TENKH,DIACHI,DIENTHOAI) 
VALUES (3,N'NGUYỄN VĂN M',N'16/11 HUỲNH VĂN BÁNH F3 PN','0903648218')
INSERT INTO KHACHHANG(MSKH,TENKH,DIACHI,DIENTHOAI) 
VALUES (4,N'NGUYỄN VĂN C',N'16/11 BÙI THỊ XUÂN F3 TB','0903648812')

---TẠO DỮ LIỆU NHÂN VIÊN
SET DATEFORMAT YMD

INSERT INTO NHANVIEN(MSNV,TENNV,DIACHI,CMND,DIENTHOAI,NGAYSINH)
VALUES(1,N'PHẠM VĂN THIỆN',N'16 BTX F3 TB','5632987546','0903648214','1985-09-09')
INSERT INTO NHANVIEN(MSNV,TENNV,DIACHI,CMND,DIENTHOAI,NGAYSINH)
VALUES(2,N'NGUYỄN ĐÌNH HOÀNG',N'16 BTX F3 TB','5672917546','0903648252','1980-05-17')	
INSERT INTO NHANVIEN(MSNV,TENNV,DIACHI,CMND,DIENTHOAI,NGAYSINH)
VALUES(3,N'NGUYỄN TRUNG KIÊN',N'16 BTX F3 TB','563981746','0903649872','1979-10-16')	
INSERT INTO NHANVIEN(MSNV,TENNV,DIACHI,CMND,DIENTHOAI,NGAYSINH)
VALUES(4,N'NGUYỄN THÁI HÒA',N'12/65 THU DUC','1832987546','0903606542' ,'1981-04-01')	

---TẠO DỮ LIỆU HÓA ĐƠN
INSERT INTO HOADON(MSHD,NGAYHD,MSKH,MSNV)
	VALUES(1,'2019-01-01',1,1)
INSERT INTO HOADON(MSHD,NGAYHD,MSKH,MSNV)
	VALUES(2,'2019-01-02',2,2)
INSERT INTO HOADON(MSHD,NGAYHD,MSKH,MSNV)
	VALUES(3,'2019-01-01',1,2)
INSERT INTO HOADON(MSHD,NGAYHD,MSKH,MSNV)
	VALUES(4,'2019-01-01',1,1)

---TẠO DỮ LIỆU CT HÓA ĐƠN	
INSERT INTO CT_HOADON(MSHD,MSMH,SOLUONG)
	VALUES(1,1,1)
INSERT INTO CT_HOADON(MSHD,MSMH,SOLUONG)
	VALUES(1,3,2)
INSERT INTO CT_HOADON(MSHD,MSMH,SOLUONG)
	VALUES(2,1,1)
INSERT INTO CT_HOADON(MSHD,MSMH,SOLUONG)
	VALUES(2,2,3)
INSERT INTO CT_HOADON(MSHD,MSMH,SOLUONG)
	VALUES(2,4,1)
INSERT INTO CT_HOADON(MSHD,MSMH,SOLUONG)
	VALUES(3,2,4)
INSERT INTO CT_HOADON(MSHD,MSMH,SOLUONG)
	VALUES(4,1,6)
INSERT INTO CT_HOADON(MSHD,MSMH,SOLUONG)
	VALUES(4,3,10)
INSERT INTO CT_HOADON(MSHD,MSMH,SOLUONG)
	VALUES(4,2,15)

SELECT * FROM DB2.dbo.NHANVIEN
SELECT * FROM DB2.dbo.MATHANG
SELECT * FROM DB2.dbo.KHACHHANG
SELECT * FROM DB2.dbo.CT_HOADON
SELECT * FROM DB2.dbo.HOADON